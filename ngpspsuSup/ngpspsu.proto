#   Protocol file for the NGPS power supply unit
#
#   (\$1PVNAME) = redirects output to the given record
#   

InTerminator = CR LF; 
OutTerminator = CR; # Can also be CR LF

# Mismatch error handler

error_mismatch_catcher {
	in "\#NAK:%(\$1ERROR)2c";
}

# Normal functions

get_version {
	out "VER";
	in "\#VER:%39c";
    @mismatch { error_mismatch_catcher; }
}

start {
    out "MON";
    in "\#AK";
    @mismatch { error_mismatch_catcher; }
}

stop {
    out "MOFF";
    in "\#AK";
    @mismatch { error_mismatch_catcher; }
}

read_status {
    out "MST";
    in "\#MST:%(\$1STAT:HEX:1:RAW.A)1x"
        "%(\$1STAT:HEX:2:RAW.A)1x"
        "%(\$1STAT:HEX:3:RAW.A)1x"
        "%(\$1STAT:HEX:4:RAW.A)1x"
        "%(\$1STAT:HEX:5:RAW.A)1x"
        "%(\$1STAT:HEX:6:RAW.A)1x"
        "%(\$1STAT:HEX:7:RAW.A)1x"
        "%(\$1STAT:HEX:8:RAW.A)1x";
}